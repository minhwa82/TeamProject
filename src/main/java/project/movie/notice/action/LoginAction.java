package project.movie.notice.action;
import java.io.PrintWriter;


import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpSession;

import project.movie.notice.db.MemberDTO;
import project.movie.notice.db.NoticeDAO;


public class LoginAction implements Action {

	@Override
	public ActionForward execute(
			HttpServletRequest request, HttpServletResponse response) throws Exception {

		MemberDTO dto = new MemberDTO();
		dto.setMem_id(request.getParameter("id"));
		dto.setMem_pw(request.getParameter("pw"));

		System.out.println(" M : " + dto);
		
		NoticeDAO dao = new NoticeDAO();
		int result = dao.loginMember(dto);
		
		if(result == 0) { // 비밀번호 오류
			
			response.setContentType("text/html; charset=UTF-8"); 
			PrintWriter out = response.getWriter();
			out.write("<script>");
			out.write("  alert('비밀번호가 맞지 않습니다.'); ");
			out.write("  history.back(); ");
			out.write("</script>");
			out.close();
			return null; 
			
		} if (result == -1) { // 회원정보 없음
		
			response.setContentType("text/html; charset=UTF-8"); 
			PrintWriter out = response.getWriter();
			out.write("<script>");
			out.write(" alert('등록된 회원정보가 없습니다.');");                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     
			out.write(" history.back(); ");
			out.write("</script>");
			out.close();
			return null; 
			
		} // result == 1 로그인 성공
		
		HttpSession session = request.getSession();
		session.setAttribute("id", dto.getMem_id());
		
		ActionForward forward = new ActionForward();
		forward.setPath("./AdminPage.no");
		forward.setRedirect(true);
		
		return forward;
		
	}
	
}
